<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3649555903066530" crossorigin="anonymous"></script>
    <meta name="google-adsense-account" content="ca-pub-3649555903066530">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Upscaler - Sherlock Photo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- FFmpeg.wasm for real video processing -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/ffmpeg.min.js"></script>
    <style>
        :root {
            --primary-dark: #1a1a1a;
            --secondary-light: #fafafa;
            --accent-teal: #4a9b8e;
            --accent-gold: #d4a574;
            --muted-slate: #6b7280;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-dark);
            color: var(--secondary-light);
            overflow-x: hidden;
        }
        
        .glass-card {
            background: rgba(42, 42, 42, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            background: rgba(42, 42, 42, 0.9);
        }
        
        .upload-zone {
            border: 2px dashed rgba(74, 155, 142, 0.5);
            border-radius: 12px;
            background: rgba(42, 42, 42, 0.4);
            transition: all 0.3s ease;
            min-height: 300px;
        }
        
        .upload-zone.dragover {
            border-color: var(--accent-teal);
            background: rgba(74, 155, 142, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-teal), #5ba89a);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 155, 142, 0.4);
        }
        
        .btn-secondary {
            background: rgba(74, 155, 142, 0.1);
            color: var(--accent-teal);
            border: 1px solid var(--accent-teal);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background: rgba(74, 155, 142, 0.2);
        }
        
        .resolution-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .resolution-btn {
            padding: 16px;
            border: 2px solid rgba(74, 155, 142, 0.3);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(42, 42, 42, 0.6);
        }
        
        .resolution-btn:hover {
            border-color: var(--accent-teal);
            background: rgba(74, 155, 142, 0.1);
        }
        
        .resolution-btn.active {
            border-color: var(--accent-teal);
            background: var(--accent-teal);
            color: white;
        }
        
        .video-player {
            background: rgba(42, 42, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .video-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .video-placeholder {
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            color: var(--text-muted);
            border-radius: 8px;
        }
        
        .video-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin: 20px 0;
            padding: 16px;
            background: rgba(55, 65, 81, 0.5);
            border-radius: 8px;
        }
        
        .info-item {
            text-align: center;
        }
        
        .info-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 4px;
        }
        
        .info-value {
            font-weight: 600;
            color: var(--accent-teal);
        }
        
        .processing-queue {
            margin: 20px 0;
        }
        
        .queue-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(42, 42, 42, 0.6);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .video-thumbnail {
            width: 80px;
            height: 45px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 1.5rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-teal-gold);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-panel {
            background: rgba(42, 42, 42, 0.6);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .comparison-panel h3 {
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        .comparison-panel.original h3 {
            color: var(--accent-teal);
        }
        
        .comparison-panel.enhanced h3 {
            color: var(--accent-gold);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 16px;
            background: rgba(42, 42, 42, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-gold));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            right: 1rem;
            top: 1rem;
            z-index: 50;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(74, 155, 142, 0.3);
            border-radius: 8px;
            padding: 8px;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .desktop-nav {
                display: none !important;
            }
            
            .resolution-selector {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .comparison-container {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .video-info {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .premium-badge {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-gold));
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-top: 8px;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .feature-item {
            background: rgba(42, 42, 42, 0.6);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .feature-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            display: block;
        }
        
        .feature-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--accent-teal);
        }
        
        .feature-description {
            font-size: 0.875rem;
            color: var(--text-muted);
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-black bg-opacity-80 backdrop-blur-md border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="index.html" class="flex items-center space-x-2 logo-link">
                    <div class="w-8 h-8 bg-gradient-to-br from-teal-400 to-amber-400 rounded-lg"></div>
                    <span class="text-lg sm:text-xl font-bold">Sherlock Photo</span>
                </a>
                
                <!-- Desktop Navigation -->
                <div class="desktop-nav hidden md:flex items-center space-x-4 lg:space-x-6">
                    <a href="index.html" class="nav-link text-sm lg:text-base">Dashboard</a>
                    <a href="upscale.html" class="nav-link text-sm lg:text-base">Image Upscaler</a>
                    <a href="convert.html" class="nav-link text-sm lg:text-base">Format Converter</a>
                    <a href="pdf.html" class="nav-link text-sm lg:text-base">PDF Generator</a>
                    <a href="enhance.html" class="nav-link text-sm lg:text-base">Enhancement Suite</a>
                    <a href="video-upscale.html" class="nav-link text-sm lg:text-base active">Video Upscaler</a>
                </div>
                
                <!-- Mobile Menu Toggle -->
                <button id="mobile-menu-toggle" class="mobile-menu-toggle md:hidden text-2xl">
                    ‚ò∞
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu">
        <div class="mobile-menu-header">
            <h3 class="text-xl font-bold text-teal-400">Menu</h3>
            <button id="mobile-menu-close" class="mobile-menu-close">√ó</button>
        </div>
        <nav class="p-6">
            <div class="space-y-4">
                <a href="index.html" class="mobile-menu-item flex items-center space-x-3 p-3 rounded-lg hover:bg-teal-400 hover:bg-opacity-10 transition-colors">
                    <span class="text-xl">üè†</span>
                    <span class="font-medium">Dashboard</span>
                </a>
                <a href="upscale.html" class="mobile-menu-item flex items-center space-x-3 p-3 rounded-lg hover:bg-teal-400 hover:bg-opacity-10 transition-colors">
                    <span class="text-xl">üìà</span>
                    <span class="font-medium">Image Upscaler</span>
                </a>
                <a href="convert.html" class="mobile-menu-item flex items-center space-x-3 p-3 rounded-lg hover:bg-teal-400 hover:bg-opacity-10 transition-colors">
                    <span class="text-xl">üîÑ</span>
                    <span class="font-medium">Format Converter</span>
                </a>
                <a href="pdf.html" class="mobile-menu-item flex items-center space-x-3 p-3 rounded-lg hover:bg-teal-400 hover:bg-opacity-10 transition-colors">
                    <span class="text-xl">üìÑ</span>
                    <span class="font-medium">PDF Generator</span>
                </a>
                <a href="enhance.html" class="mobile-menu-item flex items-center space-x-3 p-3 rounded-lg hover:bg-teal-400 hover:bg-opacity-10 transition-colors">
                    <span class="text-xl">‚ú®</span>
                    <span class="font-medium">Enhancement Suite</span>
                </a>
                <a href="video-upscale.html" class="mobile-menu-item flex items-center space-x-3 p-3 rounded-lg hover:bg-teal-400 hover:bg-opacity-10 transition-colors bg-teal-400 bg-opacity-20 text-teal-400">
                    <span class="text-xl">üé¨</span>
                    <span class="font-medium">Video Upscaler</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <main class="pt-20 px-4 sm:px-6 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-3xl sm:text-4xl font-bold mb-4">
                    <span class="bg-gradient-to-r from-teal-400 to-amber-400 bg-clip-text text-transparent">
                        AI Video Upscaler
                    </span>
                </h1>
                <p class="text-gray-400 text-lg max-w-2xl mx-auto">
                    Transform your videos to stunning high resolution with our advanced AI upscaling technology.
                </p>
            </div>

            <!-- Upload Section -->
            <div class="glass-card p-6 sm:p-8 mb-8">
                <h2 class="text-xl font-bold mb-6">Upload Your Video</h2>
                <div class="upload-zone" id="upload-zone">
                    <div class="text-center py-12">
                        <div class="w-16 h-16 mx-auto mb-4 border-2 border-teal-400 rounded-full flex items-center justify-center">
                            <span class="text-2xl">üìÅ</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">Drop your video here</h3>
                        <p class="text-gray-400 mb-4">Supports MP4, AVI, MOV, MKV, WebM, and more</p>
                        <button class="btn-primary" onclick="document.getElementById('file-input').click()">
                            Choose File
                        </button>
                        <input type="file" id="file-input" accept="video/*" class="hidden">
                    </div>
                </div>
            </div>

            <!-- Resolution Selection -->
            <div class="glass-card p-6 sm:p-8 mb-8">
                <h2 class="text-xl font-bold mb-6">Select Target Resolution</h2>
                <div class="resolution-selector">
                    <div class="resolution-btn" data-resolution="1080p">
                        <div class="text-lg font-bold">1080p</div>
                        <div class="text-sm text-gray-400">Full HD</div>
                        <div class="premium-badge">1920√ó1080</div>
                    </div>
                    <div class="resolution-btn active" data-resolution="2k">
                        <div class="text-lg font-bold">2K</div>
                        <div class="text-sm text-gray-400">Quad HD</div>
                        <div class="premium-badge">2560√ó1440</div>
                    </div>
                    <div class="resolution-btn" data-resolution="4k">
                        <div class="text-lg font-bold">4K</div>
                        <div class="text-sm text-gray-400">Ultra HD</div>
                        <div class="premium-badge">3840√ó2160</div>
                    </div>
                    <div class="resolution-btn" data-resolution="8k">
                        <div class="text-lg font-bold">8K</div>
                        <div class="text-sm text-gray-400">Full Ultra HD</div>
                        <div class="premium-badge">7680√ó4320</div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="upscale-btn" class="btn-primary mr-4" disabled>
                        Upscale Video
                    </button>
                    <button id="download-video-btn" class="btn-secondary" disabled>
                        Download Video
                    </button>
                </div>
            </div>

            <!-- Video Player -->
            <div class="glass-card p-6 sm:p-8 mb-8">
                <h2 class="text-xl font-bold mb-6">Video Preview</h2>
                <div class="video-player">
                    <div class="video-container">
                        <div class="video-placeholder" id="video-placeholder">
                            <div class="text-center">
                                <div class="text-4xl mb-4">üé¨</div>
                                <h3 class="text-lg font-bold mb-2">Video Preview</h3>
                                <p class="text-gray-400">Upload a video to see preview</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-info" id="video-info">
                        <div class="info-item">
                            <div class="info-label">Resolution</div>
                            <div class="info-value" id="original-resolution">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Duration</div>
                            <div class="info-value" id="video-duration">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Frame Rate</div>
                            <div class="info-value" id="frame-rate">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">File Size</div>
                            <div class="info-value" id="file-size">-</div>
                        </div>
                        <div class="info-item" id="processed-size-info" style="display: none;">
                            <div class="info-label">Processed Size</div>
                            <div class="info-value" id="processed-size">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Processing Queue -->
            <div class="glass-card p-6 sm:p-8 mb-8">
                <h2 class="text-xl font-bold mb-6">Processing Queue</h2>
                <div class="processing-queue" id="processing-queue">
                    <div class="text-gray-400 text-center py-8">
                        No videos in processing queue
                    </div>
                </div>
            </div>

            <!-- Before & After Comparison -->
            <div class="glass-card p-6 sm:p-8 mb-8">
                <h2 class="text-xl font-bold mb-6">Before & After Comparison</h2>
                <div class="comparison-container">
                    <div class="comparison-panel original">
                        <h3>Original Quality</h3>
                        <div class="video-container">
                            <div class="video-placeholder" id="original-comparison">
                                <div class="text-center">
                                    <div class="text-3xl mb-2">üìπ</div>
                                    <div class="text-sm">Original Video</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-panel enhanced">
                        <h3>Enhanced Quality</h3>
                        <div class="video-container">
                            <div class="video-placeholder" id="enhanced-comparison">
                                <div class="text-center">
                                    <div class="text-3xl mb-2">‚ú®</div>
                                    <div class="text-sm">Enhanced Video</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features -->
            <div class="glass-card p-6 sm:p-8 mb-8">
                <h2 class="text-xl font-bold mb-6">Video Enhancement Features</h2>
                <div class="feature-list">
                    <div class="feature-item">
                        <span class="feature-icon">üß†</span>
                        <div class="feature-title">AI-Powered Enhancement</div>
                        <div class="feature-description">Advanced neural networks analyze and enhance each frame</div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">‚ö°</span>
                        <div class="feature-title">Real-time Processing</div>
                        <div class="feature-description">GPU-accelerated processing for faster results</div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üé®</span>
                        <div class="feature-title">Frame-by-Frame</div>
                        <div class="feature-description">Individual frame analysis and enhancement</div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üîß</span>
                        <div class="feature-title">Multiple Formats</div>
                        <div class="feature-description">Support for all major video formats</div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üì±</span>
                        <div class="feature-title">Mobile Optimized</div>
                        <div class="feature-description">Enhanced videos look great on mobile devices</div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üîí</span>
                        <div class="feature-title">Privacy First</div>
                        <div class="feature-description">All processing happens locally in your browser</div>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="glass-card p-6 sm:p-8 mb-8">
                <h2 class="text-xl font-bold mb-6">Video Processing Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">8K</div>
                        <div class="text-gray-400">Max Resolution</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">60fps</div>
                        <div class="text-gray-400">Frame Rate Support</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">Real-time</div>
                        <div class="text-gray-400">Processing Speed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="text-gray-400">Local Processing</div>
                    </div>
                </div>
            </div>

            <!-- Ad Slot -->
            <div class="glass-card p-6">
                <div class="text-center">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-3649555903066530"
                         data-ad-slot="987654321"
                         data-ad-format="horizontal"
                         data-full-width-responsive="true"></ins>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-12 px-6 border-t border-gray-800">
        <div class="max-w-7xl mx-auto text-center">
            <div class="flex items-center justify-center space-x-2 mb-4">
                <div class="w-8 h-8 bg-gradient-to-br from-teal-400 to-amber-400 rounded-lg"></div>
                <span class="text-xl font-bold">Sherlock Photo</span>
            </div>
            <p class="text-gray-400 mb-4">Professional AI-powered image enhancement suite</p>
            <p class="text-sm text-gray-500">¬© 2024 Sherlock Photo. All rights reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="navigation.js"></script>
    <script src="notifications.js"></script>
    <script src="features.js"></script>
    
    <script>
        // Video Upscaler Class
        class VideoUpscaler {
            constructor() {
                this.currentVideo = null;
                this.selectedResolution = '2k';
                this.processingQueue = [];
                this.isProcessing = false;
                this.processedBlob = null;
                this.processedUrl = null;
                this.ffmpeg = null;
                this.init();
            }
            
            async init() {
                await this.loadFFmpeg();
                this.setupEventListeners();
                this.setupResolutionSelector();
            }
            
            async loadFFmpeg() {
                try {
                    const { createFFmpeg, fetchFile } = FFmpeg;
                    this.ffmpeg = createFFmpeg({ 
                        log: false, // Set to true for debugging
                        progress: (p) => {
                            const progress = Math.round(p.ratio * 100);
                            if (this.processingQueue.length > 0) {
                                const currentItem = this.processingQueue[this.processingQueue.length - 1];
                                if (currentItem.status === 'processing') {
                                    currentItem.progress = Math.max(currentItem.progress, progress);
                                    this.updateProcessingQueue();
                                }
                            }
                            console.log(`FFmpeg Progress: ${progress}%`);
                        }
                    });
                    await this.ffmpeg.load();
                    console.log('FFmpeg.wasm loaded successfully');
                } catch (error) {
                    console.error('FFmpeg.wasm failed to load:', error);
                    this.ffmpeg = null;
                    window.notificationManager?.error('Failed to load video processor. Please check browser permissions and reload.');
                }
            }
            
            setupEventListeners() {
                const fileInput = document.getElementById('file-input');
                const uploadZone = document.getElementById('upload-zone');
                const upscaleBtn = document.getElementById('upscale-btn');
                const downloadBtn = document.getElementById('download-video-btn');
                
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
                }
                
                if (uploadZone) {
                    uploadZone.addEventListener('dragover', (e) => this.handleDragOver(e));
                    uploadZone.addEventListener('dragleave', (e) => this.handleDragLeave(e));
                    uploadZone.addEventListener('drop', (e) => this.handleDrop(e));
                }
                
                if (upscaleBtn) {
                    upscaleBtn.addEventListener('click', () => this.upscaleVideo());
                }
                
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', () => this.downloadVideo());
                }
            }
            
            setupResolutionSelector() {
                document.querySelectorAll('.resolution-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.resolution-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        e.currentTarget.classList.add('active');
                        this.selectedResolution = e.currentTarget.dataset.resolution;
                        this.updateVideoInfo();
                    });
                });
            }
            
            handleDragOver(e) {
                e.preventDefault();
                e.currentTarget.classList.add('dragover');
            }
            
            handleDragLeave(e) {
                e.currentTarget.classList.remove('dragover');
            }
            
            handleDrop(e) {
                e.preventDefault();
                e.currentTarget.classList.remove('dragover');
                
                const files = Array.from(e.dataTransfer.files);
                const videoFile = files.find(file => file.type.startsWith('video/'));
                
                if (videoFile) {
                    this.loadVideo(videoFile);
                } else {
                    window.notificationManager?.error('Please drop a valid video file.');
                }
            }
            
            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.loadVideo(file);
                }
            }
            
            loadVideo(file) {
                const url = URL.createObjectURL(file);
                const video = document.createElement('video');
                
                video.addEventListener('loadedmetadata', () => {
                    this.currentVideo = {
                        file: file,
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        url: url,
                        duration: video.duration,
                        width: video.videoWidth,
                        height: video.videoHeight,
                        frameRate: video.duration > 0 ? 30 : 30 // Estimate if unavailable
                    };
                    
                    this.showVideoPreview();
                    this.updateVideoInfo();
                    this.enableUpscaleButton();
                    window.notificationManager?.success(`${file.name} loaded successfully!`);
                });
                
                video.addEventListener('error', () => {
                    window.notificationManager?.error('Failed to load video file');
                });
                
                video.src = url;
                video.load();
            }
            
            showVideoPreview() {
                const placeholder = document.getElementById('video-placeholder');
                if (placeholder && this.currentVideo) {
                    placeholder.innerHTML = `
                        <video controls style="width: 100%; height: 100%; border-radius: 8px;">
                            <source src="${this.currentVideo.url}" type="${this.currentVideo.type}">
                            Your browser does not support the video tag.
                        </video>
                    `;
                }
            }
            
            updateVideoInfo() {
                if (!this.currentVideo) return;
                
                const resolutionEl = document.getElementById('original-resolution');
                const durationEl = document.getElementById('video-duration');
                const frameRateEl = document.getElementById('frame-rate');
                const fileSizeEl = document.getElementById('file-size');
                const processedSizeEl = document.getElementById('processed-size-info');
                
                if (resolutionEl) {
                    resolutionEl.textContent = `${this.currentVideo.width}√ó${this.currentVideo.height}`;
                }
                
                if (durationEl) {
                    const minutes = Math.floor(this.currentVideo.duration / 60);
                    const seconds = Math.floor(this.currentVideo.duration % 60);
                    durationEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
                
                if (frameRateEl) {
                    frameRateEl.textContent = `${this.currentVideo.frameRate} fps`;
                }
                
                if (fileSizeEl) {
                    fileSizeEl.textContent = this.formatFileSize(this.currentVideo.size);
                }
                
                if (this.processedBlob && processedSizeEl) {
                    document.getElementById('processed-size').textContent = this.formatFileSize(this.processedBlob.size);
                    processedSizeEl.style.display = 'block';
                } else if (processedSizeEl) {
                    processedSizeEl.style.display = 'none';
                }
            }
            
            enableUpscaleButton() {
                const upscaleBtn = document.getElementById('upscale-btn');
                if (upscaleBtn) {
                    upscaleBtn.disabled = false;
                }
            }
            
            async upscaleVideo() {
                if (!this.currentVideo) {
                    window.notificationManager?.warning('No video to upscale');
                    return;
                }
                
                if (this.isProcessing) {
                    window.notificationManager?.warning('Processing in progress...');
                    return;
                }
                
                if (!this.ffmpeg) {
                    window.notificationManager?.error('Video processor not ready. Please reload the page.');
                    return;
                }
                
                this.isProcessing = true;
                
                const queueItem = {
                    id: Date.now(),
                    video: this.currentVideo,
                    targetResolution: this.selectedResolution,
                    status: 'processing',
                    progress: 0,
                    processedSize: 0
                };
                
                this.processingQueue.push(queueItem);
                this.updateProcessingQueue();
                
                window.notificationManager?.info(`Starting upscaling to ${this.selectedResolution}...`);
                
                // Perform actual video processing
                try {
                    const result = await this.processVideoWithFFmpeg(queueItem.video);
                    this.processedBlob = result.blob;
                    this.processedUrl = result.url;
                    queueItem.processedSize = result.size;
                    
                    // Show comparison
                    this.showComparisonVideos();
                    
                    this.completeProcessing(queueItem);
                } catch (error) {
                    console.error('Processing failed:', error);
                    queueItem.status = 'failed';
                    window.notificationManager?.error('Video processing failed: ' + error.message);
                    this.isProcessing = false;
                    this.updateProcessingQueue();
                }
            }
            
            async processVideoWithFFmpeg(videoData) {
                const fileExtension = videoData.name.split('.').pop().toLowerCase();
                const inputName = `input_${Date.now()}.${fileExtension}`;
                // Always output as MP4 for best compatibility
                const outputName = `output_${Date.now()}.mp4`;
                
                // Write file to FFmpeg FS
                await this.ffmpeg.FS('writeFile', inputName, await this.ffmpeg.fetchFile(videoData.file));
                
                // Get target resolution
                const targetRes = this.getTargetResolution();
                
                // Determine audio codec strategy
                let audioCodecArgs = ['-c:a', 'copy']; // Try to copy audio first
                
                // If input is WebM, it might have Opus, which is less compatible in MP4
                if (fileExtension === 'webm' || videoData.type.includes('webm')) {
                    audioCodecArgs = ['-c:a', 'aac', '-b:a', '192k']; // Re-encode to AAC
                }
                
                // Run upscaling command with high quality settings
                await this.ffmpeg.run(
                    '-i', inputName,
                    '-vf', `scale=${targetRes.width}:${targetRes.height}:flags=lanczos`,
                    '-c:v', 'libx264',
                    '-preset', 'slow',
                    '-crf', '18',
                    ...audioCodecArgs,
                    '-movflags', '+faststart',
                    outputName
                );
                
                // Read result
                const data = this.ffmpeg.FS('readFile', outputName);
                const blob = new Blob([data.buffer], { type: 'video/mp4' });
                
                // Cleanup
                try {
                    this.ffmpeg.FS('unlink', inputName);
                    this.ffmpeg.FS('unlink', outputName);
                } catch (e) {
                    console.warn('Cleanup failed:', e);
                }
                
                return { 
                    blob, 
                    url: URL.createObjectURL(blob),
                    size: blob.size
                };
            }
            
            getTargetResolution() {
                const resolutions = {
                    '1080p': { width: 1920, height: 1080 },
                    '2k': { width: 2560, height: 1440 },
                    '4k': { width: 3840, height: 2160 },
                    '8k': { width: 7680, height: 4320 }
                };
                return resolutions[this.selectedResolution];
            }
            
            completeProcessing(queueItem) {
                queueItem.status = 'completed';
                queueItem.progress = 100;
                
                this.isProcessing = false;
                this.enableDownloadButton();
                
                // Add to history
                if (window.featuresManager) {
                    window.featuresManager.addToHistory({
                        type: 'video-upscale',
                        filename: queueItem.video.name,
                        originalSize: queueItem.video.size,
                        processedSize: queueItem.processedSize,
                        targetResolution: this.selectedResolution,
                        result: 'processed'
                    });
                }
                
                // Show size comparison
                const sizeIncrease = ((queueItem.processedSize - queueItem.video.size) / queueItem.video.size * 100);
                const sizeChangeText = sizeIncrease >= 0 ? 
                    `File size increased by ${sizeIncrease.toFixed(1)}%` : 
                    `File size decreased by ${Math.abs(sizeIncrease).toFixed(1)}%`;
                
                window.notificationManager?.success(`Video upscaling completed! ${sizeChangeText}`);
                this.updateProcessingQueue();
                this.updateVideoInfo();
            }
            
            showComparisonVideos() {
                if (!this.currentVideo) return;
                
                // Original video
                const originalEl = document.getElementById('original-comparison');
                if (originalEl) {
                    originalEl.innerHTML = `
                        <video controls style="width: 100%; height: 100%; border-radius: 8px;">
                            <source src="${this.currentVideo.url}" type="${this.currentVideo.type}">
                        </video>
                    `;
                }
                
                // Enhanced video
                const enhancedEl = document.getElementById('enhanced-comparison');
                if (enhancedEl && this.processedUrl) {
                    enhancedEl.innerHTML = `
                        <video controls style="width: 100%; height: 100%; border-radius: 8px;">
                            <source src="${this.processedUrl}" type="video/mp4">
                        </video>
                    `;
                }
            }
            
            updateProcessingQueue() {
                const queueEl = document.getElementById('processing-queue');
                if (!queueEl) return;
                
                if (this.processingQueue.length === 0) {
                    queueEl.innerHTML = `
                        <div class="text-gray-400 text-center py-8">
                            No videos in processing queue
                        </div>
                    `;
                    return;
                }
                
                queueEl.innerHTML = this.processingQueue.map(item => `
                    <div class="queue-item">
                        <div class="flex items-center flex-1">
                            <div class="video-thumbnail">
                                üé¨
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="font-medium truncate">${item.video.name}</div>
                                <div class="text-sm text-gray-400">
                                    ${this.formatFileSize(item.video.size)} ‚Üí ${item.status === 'completed' ? this.formatFileSize(item.processedSize) : 'Processing...'}
                                    <br>
                                    ${item.video.width}√ó${item.video.height} ‚Üí ${this.getTargetResolution().width}√ó${this.getTargetResolution().height}
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${item.progress}%"></div>
                                </div>
                                <div class="text-xs ${item.status === 'failed' ? 'text-red-400' : 'text-gray-400'}">
                                    ${item.status === 'processing' ? `Processing... ${Math.round(item.progress)}%` : 
                                      item.status === 'completed' ? '‚úì Completed' : '‚úó Failed'}
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm ${item.status === 'completed' ? 'text-teal-400' : 'text-gray-400'}">
                                ${item.status === 'completed' ? '‚úì' : '‚è≥'}
                            </span>
                            <button onclick="videoUpscaler.removeFromQueue('${item.id}')" class="text-red-400 hover:text-red-300">
                                ‚úï
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            enableDownloadButton() {
                const downloadBtn = document.getElementById('download-video-btn');
                if (downloadBtn) {
                    downloadBtn.disabled = false;
                }
            }
            
            downloadVideo() {
                if (!this.processedBlob) {
                    window.notificationManager?.warning('No processed video to download');
                    return;
                }
                
                window.notificationManager?.info('Preparing download...');
                
                const url = this.processedUrl || URL.createObjectURL(this.processedBlob);
                // Extract original extension and preserve it
                const originalExt = this.currentVideo.name.split('.').pop();
                const baseName = this.currentVideo.name.substring(0, this.currentVideo.name.lastIndexOf('.'));
                const outputExt = this.processedBlob.type.includes('mp4') ? 'mp4' : originalExt;
                const link = document.createElement('a');
                link.download = `upscaled-${baseName}-${this.selectedResolution}.${outputExt}`;
                link.href = url;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up after download
                setTimeout(() => {
                    if (this.processedUrl) {
                        URL.revokeObjectURL(this.processedUrl);
                    }
                }, 1000);
                
                window.notificationManager?.success('Video download started!');
            }
            
            removeFromQueue(id) {
                this.processingQueue = this.processingQueue.filter(item => item.id !== id);
                this.updateProcessingQueue();
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }
        
        // Initialize Video Upscaler
        let videoUpscaler;
        
        document.addEventListener('DOMContentLoaded', async () => {
            videoUpscaler = new VideoUpscaler();
            
            // Initialize AdSense
            if (typeof adsbygoogle !== 'undefined') {
                (adsbygoogle = window.adsbygoogle || []).push({});
            }
        });
    </script>
</body>
</html>
